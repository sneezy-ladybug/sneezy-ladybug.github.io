<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="A Comprehensive Primer on IPTables" /><meta name="author" content="babligan" /><meta property="og:locale" content="en_US" /><meta name="description" content="IPTables is essentially the built in command-line tool for managing Netfilter hooks which basically manages firewall rules. IPTables interacts with the netfilter framework to filter through packets. Every incoming or outgoing network packet traversing the networking system will trigger the hooks on netfilter allowing programs that register with these hooks to interact with the traffic and to check that the packets conform to the existing firewall rules." /><meta property="og:description" content="IPTables is essentially the built in command-line tool for managing Netfilter hooks which basically manages firewall rules. IPTables interacts with the netfilter framework to filter through packets. Every incoming or outgoing network packet traversing the networking system will trigger the hooks on netfilter allowing programs that register with these hooks to interact with the traffic and to check that the packets conform to the existing firewall rules." /><link rel="canonical" href="https://sneezy-ladybug.github.io/posts/primer-on-iptables/" /><meta property="og:url" content="https://sneezy-ladybug.github.io/posts/primer-on-iptables/" /><meta property="og:site_name" content="Sneezy Ladybug" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-20T11:10:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="A Comprehensive Primer on IPTables" /><meta name="twitter:site" content="@sneezy_ladybug" /><meta name="twitter:creator" content="@babligan" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"babligan"},"headline":"A Comprehensive Primer on IPTables","dateModified":"2021-03-08T12:18:28+00:00","datePublished":"2021-02-20T11:10:00+00:00","description":"IPTables is essentially the built in command-line tool for managing Netfilter hooks which basically manages firewall rules. IPTables interacts with the netfilter framework to filter through packets. Every incoming or outgoing network packet traversing the networking system will trigger the hooks on netfilter allowing programs that register with these hooks to interact with the traffic and to check that the packets conform to the existing firewall rules.","url":"https://sneezy-ladybug.github.io/posts/primer-on-iptables/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://sneezy-ladybug.github.io/posts/primer-on-iptables/"},"@context":"https://schema.org"}</script><title>A Comprehensive Primer on IPTables | Sneezy Ladybug</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-D8RZPKVWG8"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-D8RZPKVWG8'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/babligan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sneezy Ladybug</a></div><div class="site-subtitle font-italic">Writer. Infosec enthusiast. Interested in Offensive Infrastructure.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sneezy-ladybug" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/sneezy_ladybug" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>A Comprehensive Primer on IPTables</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>A Comprehensive Primer on IPTables</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> babligan </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Feb 20, 2021, 11:10 AM +0000" prep="on" > Feb 20 <i class="unloaded">2021-02-20T11:10:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Mar 8, 2021, 12:18 PM +0000" prefix="Updated " > Mar 8 <i class="unloaded">2021-03-08T12:18:28+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1678 words">9 min</span></div></div><div class="post-content"><p>IPTables is essentially the built in command-line tool for managing Netfilter hooks which basically manages firewall rules. IPTables interacts with the netfilter framework to filter through packets. Every incoming or outgoing network packet traversing the networking system will trigger the hooks on netfilter allowing programs that register with these hooks to interact with the traffic and to check that the packets conform to the existing firewall rules.</p><p>IPTables isn’t the only tool available for interacting with the netfilter framework. UFW (Uncomplcated firewall), firewalld and nftables can all interact with the netfilter framework to provide firewall functionality.</p><p>IPTables are really versatile. They are able to:</p><ul><li>Filter through IPv4 and IPv6 packets<li>Both network and port translation (NAT/NAPT)<li>Implement transparent proxies with NAT which becomes especially useful for port redirection.<li>Packet manipulation (mangling) by altering the Type of Service, DSCP fields or the ECN flag.</ul><h2 id="basic-structure">Basic Structure</h2><p>iptables is made up of some basic structures which are ‘layered’. IPTables use:</p><ul><li>Tables<li>Chains<li>Rules with Targets</ul><p>With IPTables, multiple TABLES can be defined. Each table contains various chains and a chain is basically a set of rules. Rules define what happens to a packet. If a packet matches the rule, it goes to the specified TARGET. If the criteria is not matched, it moves on to the next rule. Every packet moves through the ruleset until it is either accepted, dropped or moved elsewhere.</p><h3 id="tables">Tables</h3><p>IPTables provides 5 key tables each representing a distinct set of rules, organized by area of concern, for evaluating packets. For example, if a rule deals with packet filtering, it will be put into the filter table. If it deals with packet manipulation, it will belong to the Mangle table. Any table can call itself and it also can execute its own rules, which enables possibilities for additional processing and iteration.</p><p>IPTables are based on the netfilter modules i.e</p><ul><li>the <code class="language-plaintext highlighter-rouge">iptable_raw</code> module which then becomes the Raw table is responsible for filtering packets before they reach more memory demanding operations.<li>the <code class="language-plaintext highlighter-rouge">iptable_mangle</code> module becomes the Mangle table is responsible for modifying the packet by altering the IP headers.<li>the <code class="language-plaintext highlighter-rouge">iptable_nat</code> module becomes the Nat table. It registers 2 hooks, the DNAT (Destination NAT) which transforms the packet before it’s pushed to the filter hook and the SNAT (Source NAT) which modifies the packet after it’s been through the filter hook. The NAT table fucntions as a configuration database and no packet filtering occurs.<li>the <code class="language-plaintext highlighter-rouge">iptable_filter</code> module becomes the Filter table and thie table responsible for all the firewall functionality.<li>the <code class="language-plaintext highlighter-rouge">security_filter</code> module becomes the Security table and thie table responsible for rules that manage access i.e Mandatory Access Controls(MAC) and Discretionary Access Controls(DAC) which are implemented by SELinux.</ul><h3 id="chains">Chains</h3><p>Each of the 5 tables has its own predefined chains. Tables are defined by general purpose, while chains determine when rules will be evaluated. Just like tables, chains mirror the names of the netfilter hooks they are associated with. These chain titles help describe the origin in the Netfilter stack. There are 5 chains.</p><ul><li>the PREROUTING chain is triggered by the <code class="language-plaintext highlighter-rouge">NF_IP_PRE_ROUTING</code> hook immediately upon packet reception.<li>the INPUT chain is triggered by the <code class="language-plaintext highlighter-rouge">NF_IP_LOCAL_IN</code> hook once the packet is moved to a local process.<li>the FORWARD chain is triggered by the <code class="language-plaintext highlighter-rouge">NF_IP_FORWARD</code> hook once the packet forwarded through another interface.<li>the OUTPUT chain is triggered by the <code class="language-plaintext highlighter-rouge">NF_IP_LOCAL_OUT</code> hook once the packet is locally created.<li>the POSTROUTING chain is triggered by the <code class="language-plaintext highlighter-rouge">NF_IP_POST_ROUTING</code> hook once a packet is meant to be sent out.</ul><p>Each table has it’s own chains. The table below shows how the 5 chains are distributed in the 5 tables. The NAT table has been split into two becasue it processes packets before and after they pass through the filter table.</p><div class="table-wrapper"><table><thead><tr><th> <th style="text-align: center">PREROUTING<th style="text-align: center">INPUT<th style="text-align: center">FORWARD<th style="text-align: center">OUTPUT<th style="text-align: center">POSTROUTING<tbody><tr><td>Raw<td style="text-align: center">YES<td style="text-align: center">-<td style="text-align: center">-<td style="text-align: center">YES<td style="text-align: center">-<tr><td>Mangle<td style="text-align: center">YES<td style="text-align: center">YES<td style="text-align: center">YES<td style="text-align: center">YES<td style="text-align: center">YES<tr><td>NAT(DNAT)<td style="text-align: center">YES<td style="text-align: center">-<td style="text-align: center">-<td style="text-align: center">YES<td style="text-align: center">-<tr><td>Filter<td style="text-align: center">-<td style="text-align: center">YES<td style="text-align: center">YES<td style="text-align: center">YES<td style="text-align: center">-<tr><td>Security<td style="text-align: center">-<td style="text-align: center">YES<td style="text-align: center">YES<td style="text-align: center">YES<td style="text-align: center">-<tr><td>NAT(SNAT)<td style="text-align: center">-<td style="text-align: center">YES<td style="text-align: center">-<td style="text-align: center">-<td style="text-align: center">YES</table></div><p>Now that the <code class="language-plaintext highlighter-rouge">raw</code> table has 3 chains, how does a packet traverse that table into the next (<code class="language-plaintext highlighter-rouge">mangle</code>) table? Assuming that the server knows how to route a packet and that the firewall rules permit its transmission, the following flows represent the paths that will be traversed in different situations:</p><ul><li>Incoming packets destined for the local system: <strong>PREROUTING -&gt; INPUT</strong><li>Incoming packets destined to another host: <strong>PREROUTING -&gt; FORWARD -&gt; POSTROUTING</strong><li>Locally generated packets: <strong>OUTPUT -&gt; POSTROUTING</strong></ul><p>Understanding how packets move through the IPtable will be especially important when we look at how Docker and Kubernetes interact with IPTables.</p><p>This is a very high level breakdown of how a packet would traverse the IPTable if all the tables and chains were present. For an indepth graphical analysis, I’d recommend one on <a href="https://en.wikipedia.org/wiki/Netfilter#/media/File:Netfilter-packet-flow.svg">Wikipedia</a>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traversal.png" alt="[traversal.png]" /></p><p>It can get really complicated to follow through with a packet but to see this in action, I’d advise to try out <a href="https://rlworkman.net/howtos/iptables/chunkyhtml/x6002.html">this</a> script.</p><p>Copy the contents of that file into a shell script e.g test-iptables.sh</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nano test-iptables.sh
</pre></table></code></div></div><p>Make the file executable then run it.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>chmod +x test-iptables.sh
sudo ./test-iptables.sh
</pre></table></code></div></div><p>Here, you can confirm the contents of your local IPTables.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo iptables-save
</pre></table></code></div></div><p>If all is well, run a simple ping on one tab on your terminal.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ping -c 1 google.com
</pre></table></code></div></div><p>On another tab, read the logs to see the packet traversal.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo tail -n 0 -f /var/log/syslog
</pre></table></code></div></div><p>In the end you should have something like this: <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/packet-traversal.png" alt="packet-traversal.png" /></p><p>Using the flowchart, try and figure out what’s going on. Remember that a ping consists of an echo-request and an echo-reply.</p><p>Remember to flush your iptables using <a href="https://rlworkman.net/howtos/iptables/chunkyhtml/x6015.html">this</a> script.</p><p>Just like before, copy the contents into a shell script. Make it executable and execute the file. Confirm that your IPtable is back to it’s default setting.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>nano flush-iptables.sh
chmod +x flush-iptables.sh
sudo ./flush-iptables.sh
</pre></table></code></div></div><h3 id="rules">Rules</h3><p>Chains are a series of rules that define how the packets are handled. Rules are defined as a set of matches and a target. Rules are followed by order until a match is found. If a match is found it goes to the rules specified in the TARGET or executes the special values mentioned in the rule. If the criteria is not matched, it moves on to the next rule all through the chain.</p><h4 id="matches">Matches</h4><p>A match is the criteria or condition that has to be met before a packet is handled. The conditions can be defined by the source of the packet, the destination of the packet, the protocol used by the packet and even the interface via which a packet is received or through which it is to be sent out.</p><p>For example, a rule like:</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> iptables -A INPUT -p tcp --dport 25 -j ACCEPT
</pre></table></code></div></div><p>This rule matches/accepts all incoming SMTP (port 25) packets.</p><h4 id="targets">Targets</h4><p>Targets are basically chains that determine what happens once a packet matches a rule. They are specified by the <code class="language-plaintext highlighter-rouge">-j</code> (–jump) switch i.e jump to TARGET. We could for example, DROP or ACCEPT a packet.</p><p>There are several targets available:</p><ul><li>ACCEPT - accepts the packet for processing.<li>DROP - packet is dropped.<li>RETURN - causes the packet to stop moving through the chain.<li>REJECT - acts just like DROP but sends a response back to the sender.<li>DNAT - only present in the PREROUTING and UOTPUT chains in the NAT table.<li>SNAT - present in the POSTROUTING chain of the Nat table.<li>MASQUERADE - similar to SNAT but does not require <code class="language-plaintext highlighter-rouge">--to-source</code> as it’s made to work with IPs assigned dynamically.</ul><h3 id="modifying-the-iptable">Modifying the IPTable</h3><p>To create rules you have to have sudo permissions. Usually a good starting point is to list out all the current rules that are configured. To do so, there are several commands:</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>iptables -L
iptables -S
iptables-save 
<span class="gh">#This only works if you've saved a previous configuration before.</span>
cat /etc/iptables/rules.v4 
</pre></table></code></div></div><p>A default installation of IPTables should have the INPUT, OUTPUT and FORWARD chains set to ACCEPT and no other rules present.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/default-ruleset.png" alt="[default-ruleset.png]" /></p><p>To edit a rule, the primary switches are -A which appends a new rule and -D which deletes a rule. You can also replace a rule using -R. To get more switches use the manpages.</p><p>Appending adds a rule to the end of the INPUT chain and uses the -A switch.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>iptables -A INPUT -p tcp --dport 80 -j ACCEPT
</pre></table></code></div></div><p>To delete a rule, you must know its position on the chain. Deleting uses the -D switch.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>iptables -D INPUT 1
</pre></table></code></div></div><p>This will delete the very first rule on the table.</p><p>You can create a rule at any position on the table using the insert switch. Inserting uses the -I switch.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>iptables -I INPUT 4 -p tcp --dport 443 -j DROP
</pre></table></code></div></div><p>This will insert it as the 4th rule on the INPUT chain.</p><p>You can also replace rules in the chain using the -R switch.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>iptables -R INPUT 4 -p tcp -s 172.16.10.0/24 --dport 80 -j ACCEPT
</pre></table></code></div></div><p>This rule will replace the rule on the 4th line.</p><p>To clear the iptables, use the -F switch. If no chain is specified, then all chains are flushed. Be cautious when flushing the table. If for example the INPUT policy is DROP or REJECT and the rules are flushed, all incoming traffic will be dropped or rejected and network communication broken. So before you flush your ruleset, ensure your INPUT chain has an ACCEPT policy.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>iptables -F
</pre></table></code></div></div><p>By default, the rules added to the iptables are ephemeral, which means that everytime you reboot, your rules are gone. We need to install the netfilter-package to save our rules and make them persistent even after reboots.</p><div class="language-md highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>sudo apt-get update
sudo apt install netfilter-persistent -y
<span class="gh">#To save your configurations</span>
sudo service netfilter-persistent save
sudo service netfilter-persistent restart
</pre></table></code></div></div><p><strong>Resources:</strong> If you want to learn more about setting up a simple (or complex) firewall, I’d recommend the following sites.</p><ul><li><a href="https://www.digitalocean.com/community/tutorials/iptables-essentials-common-firewall-rules-and-commands">Digital Ocean</a><li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-iptables-on-ubuntu-14-04">Digital Ocean, again</a><li><a href="https://wiki.centos.org/HowTos/Network/IPTables">CentOS Wiki</a></ul><p>I hope this blog answer some of the questions you might have had!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/infra/'>Infra</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/iptables/" class="post-tag no-text-decoration" >iptables</a> <a href="/tags/netfilter/" class="post-tag no-text-decoration" >netfilter</a> <a href="/tags/firewall/" class="post-tag no-text-decoration" >firewall</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=A Comprehensive Primer on IPTables - Sneezy Ladybug&url=https://sneezy-ladybug.github.io/posts/primer-on-iptables/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=A Comprehensive Primer on IPTables - Sneezy Ladybug&u=https://sneezy-ladybug.github.io/posts/primer-on-iptables/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=A Comprehensive Primer on IPTables - Sneezy Ladybug&url=https://sneezy-ladybug.github.io/posts/primer-on-iptables/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/passing-the-phish-II/">Passing the Phish II</a><li><a href="/posts/passing-the-phish/">Passing the Phish</a><li><a href="/posts/smtp-relaying-for-phishing/">SMTP Relaying for Phishing</a><li><a href="/posts/primer-on-iptables/">A Comprehensive Primer on IPTables</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/phishing/">phishing</a> <a class="post-tag" href="/tags/evilginx/">evilginx</a> <a class="post-tag" href="/tags/gophish/">gophish</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/iptables/">iptables</a> <a class="post-tag" href="/tags/netfilter/">netfilter</a> <a class="post-tag" href="/tags/postfix/">postfix</a> <a class="post-tag" href="/tags/smtp/">smtp</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/smtp-relaying-for-phishing/"><div class="card-body"> <span class="timeago small" > Mar 31 <i class="unloaded">2021-03-31T03:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SMTP Relaying for Phishing</h3><div class="text-muted small"><p> For anyone who’s tried to build phishing infrastucture that’s consistently reliable, you know by now how challenging that can be. First of all, a proper and functioning mail server has many moving ...</p></div></div></a></div><div class="card"> <a href="/posts/passing-the-phish-II/"><div class="card-body"> <span class="timeago small" > Jun 27 <i class="unloaded">2021-06-27T16:34:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Passing the Phish II</h3><div class="text-muted small"><p> At this point, we’ve should have covered the following according to the previous post. Installation of Gophish Setup SendGrid as our SMTP server Installation of Evilginx and setting up a lur...</p></div></div></a></div><div class="card"> <a href="/posts/passing-the-phish/"><div class="card-body"> <span class="timeago small" > Jun 25 <i class="unloaded">2021-06-25T16:34:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Passing the Phish</h3><div class="text-muted small"><p> At the core of it, phishing involves tricking a user into doing something they shouldn’t do. Also, not all phishing techniques involve tricking a user into clicking a malicious link on an email, en...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <a href="/posts/smtp-relaying-for-phishing/" class="btn btn-outline-primary" prompt="Newer"><p>SMTP Relaying for Phishing</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/sneezy_ladybug">Sneezy Ladybug</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/phishing/">phishing</a> <a class="post-tag" href="/tags/evilginx/">evilginx</a> <a class="post-tag" href="/tags/gophish/">gophish</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/iptables/">iptables</a> <a class="post-tag" href="/tags/netfilter/">netfilter</a> <a class="post-tag" href="/tags/postfix/">postfix</a> <a class="post-tag" href="/tags/smtp/">smtp</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://sneezy-ladybug.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
